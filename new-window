#!/bin/bash
# To use, put something like this in your .tmux.conf:
#     bind M-0 command-prompt -p Repository: 'run "~/bin/tmux-new-window.sh %1 0"'
 
PROJECT=$1
WINDOW=$2
 
PROJECT_DIR=~/$PROJECT
for DIR in $HOME /Volumes/git ; do
  if [ -d "$DIR/$PROJECT" ]; then
    PROJECT_DIR=$DIR/$PROJECT
  fi
done

cd $PROJECT_DIR
tmux new-window ${WINDOW:+-t$WINDOW} -n $PROJECT
if [ -d "$PROJECT_DIR/.git" -o -d "$PROJECT_DIR/../.git" ]; then
  tmux splitw -d  # Ensure kill-pane doesn't kill pane 0 (weird bug in -a)
  tmux kill-pane -a -t 0
  tmux splitw -d
  tmux splitw -d "git graph-branch --watch"
  tmux splitw -d $HOME/bin/gittools/watch-status

else
  tmux split-window -hd
fi
~/bin/tmuxtools/chrislayout

